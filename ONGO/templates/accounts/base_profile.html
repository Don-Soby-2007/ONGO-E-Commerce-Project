{% extends 'common/base_header.html' %}
{% load static %}

{% block title %}ONGO E-Commerce{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/accounts/profile_section.css' %}">

{% endblock %}

{% block content %}
<div class="flex flex-1 min-h-[calc(100vh-80px)]">

    <!-- Mobile Sidebar Toggle -->
    <button id="mobile-menu-toggle"
        class="md:hidden fixed bottom-4 right-4 z-50 bg-red-500 text-white p-3 rounded-full shadow-lg hover:bg-red-600 focus:outline-none transition-colors">
        <i data-lucide="menu" class="w-6 h-6"></i>
    </button>

    <!-- Sidebar Navigation -->
    <aside id="sidebar"
        class="w-64 bg-white border-r border-gray-200 flex flex-col fixed inset-y-0 left-0 z-40 transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 ease-in-out h-full overflow-y-auto custom-scrollbar md:h-auto md:min-h-full pt-20 md:pt-0">

        <!-- Mobile Close Button -->
        <div class="md:hidden p-4 flex justify-end">
            <button id="close-sidebar" class="text-gray-500 hover:text-gray-800">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>

        <div class="p-6 md:p-6">
            <h2 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">Account Settings</h2>
            <nav class="space-y-1">
                <a href="{% url 'profile' %}"
                    class="nav-link {% if request.resolver_match.url_name == 'profile' %}active{% endif %} flex items-center px-4 py-3 text-sm font-medium rounded-lg {% if request.resolver_match.url_name == 'profile' %}text-gray-700{% else %}text-gray-600{% endif %} hover:bg-gray-100 group">
                    <i data-lucide="user"
                        class="w-5 h-5 mr-3 {% if request.resolver_match.url_name == 'profile' %}text-gray-500{% else %}text-gray-400{% endif %} group-hover:text-red-500"></i>
                    My Account
                </a>
                <a href="#"
                    class="nav-link flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-100 group">
                    <i data-lucide="package" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-red-500"></i>
                    My Orders
                </a>
                <a href="#"
                    class="nav-link {% if request.resolver_match.url_name == 'wishlist' %}active{% endif %} flex items-center px-4 py-3 text-sm font-medium rounded-lg {% if request.resolver_match.url_name == 'wishlist' %}text-gray-700{% else %}text-gray-600{% endif %} hover:bg-gray-100 group">
                    <i data-lucide="heart"
                        class="w-5 h-5 mr-3 {% if request.resolver_match.url_name == 'wishlist' %}text-gray-500{% else %}text-gray-400{% endif %} group-hover:text-red-500"></i>
                    Wishlist
                </a>
                <a href="#"
                    class="nav-link flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-100 group">
                    <i data-lucide="wallet" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-red-500"></i>
                    Wallet
                </a>
            </nav>

            <h2 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 mt-8">Preferences</h2>
            <nav class="space-y-1">
                <a href="{% url 'manage_address' %}"
                    class="nav-link {% if 'address' in request.resolver_match.url_name %}active{% endif %} flex items-center px-4 py-3 text-sm font-medium rounded-lg {% if 'address' in request.resolver_match.url_name %}text-gray-700{% else %}text-gray-600{% endif %} hover:bg-gray-100 group">
                    <i data-lucide="map-pin"
                        class="w-5 h-5 mr-3 {% if 'address' in request.resolver_match.url_name %}text-gray-500{% else %}text-gray-400{% endif %} group-hover:text-red-500"></i>
                    Manage Address
                </a>
                <a href="{% url 'manage_password' %}"
                    class="nav-link {% if request.resolver_match.url_name == 'manage_password' %}active{% endif %} flex items-center px-4 py-3 text-sm font-medium rounded-lg {% if request.resolver_match.url_name == 'manage_password' %}text-gray-700{% else %}text-gray-600{% endif %} hover:bg-gray-100 group">
                    <i data-lucide="lock"
                        class="w-5 h-5 mr-3 {% if request.resolver_match.url_name == 'manage_password' %}text-gray-500{% else %}text-gray-400{% endif %} group-hover:text-red-500"></i>
                    Manage Password
                </a>
            </nav>

            <h2 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 mt-8">Earn</h2>
            <nav class="space-y-1">
                <a href="#"
                    class="nav-link flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-100 group">
                    <i data-lucide="gift" class="w-5 h-5 mr-3 text-gray-400 group-hover:text-red-500"></i>
                    My Referral
                </a>
            </nav>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 w-full md:w-auto">
        {% block profile_content %}
        {% endblock %}
    </main>

</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const closeSidebar = document.getElementById('close-sidebar');
        const sidebar = document.getElementById('sidebar');

        if (mobileMenuToggle && sidebar) {
            mobileMenuToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                sidebar.classList.toggle('-translate-x-full');
            });
        }

        if (closeSidebar && sidebar) {
            closeSidebar.addEventListener('click', () => {
                sidebar.classList.add('-translate-x-full');
            });
        }

        document.addEventListener('click', (e) => {
            if (window.innerWidth < 768 && sidebar &&
                !sidebar.contains(e.target) &&
                !mobileMenuToggle.contains(e.target) &&
                !sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.add('-translate-x-full');
            }
        });

        const messages = [
            {% for message in messages %}
                    {
            text: `{{ message|escapejs }}`,
            type: `{{ message.tags }}`
        }{% if not forloop.last %}, {% endif %}
    {% endfor %}
            ];

    messages.forEach(msg => {
        let icon = 'info';
        switch (msg.type) {
            case 'error': icon = 'error'; break;
            case 'warning': icon = 'warning'; break;
            case 'success': icon = 'success'; break;
            default: icon = 'info';
        }

        Swal.fire({
            toast: true,
            icon: icon,
            title: msg.text,
            position: 'top-right',
            showConfirmButton: false,
            timer: 3500,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer);
                toast.addEventListener('mouseleave', Swal.resumeTimer);
            }
        });
    });
        });

    lucide.createIcons();
</script>
{% endblock %}